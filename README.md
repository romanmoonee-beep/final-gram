# ü§ñ PR GRAM Bot

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Telegram –±–æ—Ç –¥–ª—è –≤–∑–∞–∏–º–Ω–æ–≥–æ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **Telegram Stars** –ø–ª–∞—Ç–µ–∂–µ–π.

## üåü –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üí∞ **–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ GRAM**
- –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞–ª—ã
- –í—Å—Ç—É–ø–∞–π—Ç–µ –≤ –≥—Ä—É–ø–ø—ã
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –ø–æ—Å—Ç—ã
- –°—Ç–∞–≤—å—Ç–µ —Ä–µ–∞–∫—Ü–∏–∏
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–π—Ç–µ —Å –±–æ—Ç–∞–º–∏

### üì¢ **–ü—Ä–æ–¥–≤–∏–≥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç—ã**
- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –ª—é–±–æ–≥–æ —Ç–∏–ø–∞
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é
- –ü–æ–ª—É—á–∞–π—Ç–µ –±—ã—Å—Ç—Ä—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### üéÅ **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**
- –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –¥–æ—Ö–æ–¥—ã
- –ë–æ–Ω—É—Å—ã –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- –ü—Ä–æ—Ü–µ–Ω—Ç—ã —Å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π

### ‚≠ê **Telegram Stars –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ
- –ë–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### **Backend**
- **Python 3.12+** —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º async/await
- **SQLAlchemy 2.0+** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **Aiogram 3.7+** –¥–ª—è Telegram API
- **Redis** –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ FSM
- **PostgreSQL** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**
```
app/
‚îú‚îÄ‚îÄ bot/              # Telegram –±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ handlers/     # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/    # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/  # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ states/       # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ utils/        # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ database/         # –ú–æ–¥–µ–ª–∏ –∏ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ models/       # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ services/         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ config/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ cli/              # CLI –∫–æ–º–∞–Ω–¥—ã
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**
```bash
git clone https://github.com/your-username/pr-gram-bot.git
cd pr-gram-bot
```

### 2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**

**–° Poetry (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```bash
poetry install
poetry shell
```

**–° pip:**
```bash
pip install -r requirements.txt
```

### 3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª
```

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```env
BOT_TOKEN=your_bot_token_from_botfather
DB_PASSWORD=your_database_password
ADMIN_IDS=your_telegram_id
```

### 4. **–ó–∞–ø—É—Å–∫ —Å Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
docker-compose up -d postgres redis  # –¢–æ–ª—å–∫–æ –ë–î
# –∏–ª–∏
docker-compose up -d  # –ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫
```

### 5. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
```bash
python -m app.cli.database init
python -m app.cli.database upgrade
python -m app.cli.database seed  # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
```

### 6. **–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞**
```bash
python -m app.main
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è |
|------------|----------|--------------|
| `BOT_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather | ‚úÖ |
| `DB_PASSWORD` | –ü–∞—Ä–æ–ª—å –ë–î PostgreSQL | ‚úÖ |
| `ADMIN_IDS` | ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é | ‚úÖ |
| `SECRET_KEY` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ | ‚úÖ |
| `DEBUG` | –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ | ‚ùå |
| `WEBHOOK_URL` | URL –¥–ª—è webhook (–ø—Ä–æ–¥–∞–∫—à–Ω) | ‚ùå |

### **–£—Ä–æ–≤–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

| –£—Ä–æ–≤–µ–Ω—å | –ü–æ—Ä–æ–≥ | –ö–æ–º–∏—Å—Å–∏—è | –ú–Ω–æ–∂–∏—Ç–µ–ª—å | –õ–∏–º–∏—Ç –∑–∞–¥–∞–Ω–∏–π |
|---------|-------|----------|-----------|---------------|
| ü•â Bronze | 0 GRAM | 7% | 1.0x | 5/–¥–µ–Ω—å |
| ü•à Silver | 10K GRAM | 6% | 1.2x | 15/–¥–µ–Ω—å |
| ü•á Gold | 50K GRAM | 5% | 1.35x | 30/–¥–µ–Ω—å |
| üíé Premium | 100K GRAM | 3% | 1.5x | ‚àû |

## üõ† CLI –∫–æ–º–∞–Ω–¥—ã

```bash
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î
python -m app.cli.database status     # –°—Ç–∞—Ç—É—Å –ë–î
python -m app.cli.database migrate "–æ–ø–∏—Å–∞–Ω–∏–µ"  # –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python -m app.cli.database upgrade    # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
python -m app.cli.database seed       # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
python -m app.cli.database reset      # –°–±—Ä–æ—Å –ë–î (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ —Å `structlog`
- –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏/–ø—Ä–æ–¥–∞–∫—à–Ω
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Sentry

### **–ú–µ—Ç—Ä–∏–∫–∏**
```bash
docker-compose --profile monitoring up  # –ó–∞–ø—É—Å–∫ Prometheus + Grafana
```
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin/admin)

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
users (telegram_id, balance, level, referrer_id, ...)

-- –ó–∞–¥–∞–Ω–∏—è  
tasks (id, author_id, type, reward_amount, status, ...)

-- –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
task_executions (id, task_id, user_id, status, ...)

-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
transactions (id, user_id, amount, type, ...)
```

### **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ `app/bot/handlers/`
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ `app/bot/handlers/__init__.py`
3. –î–æ–±–∞–≤—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ `app/bot/states/` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
4. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤ `app/bot/keyboards/`

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
pytest                    # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest --cov             # –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
black .                  # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
isort .                  # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
mypy app/                # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
```

## üöÄ –î–µ–ø–ª–æ–π

### **Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
# –ü—Ä–æ–¥–∞–∫—à–Ω
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# –° –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
docker-compose --profile monitoring up -d
```

### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω**
```env
DEBUG=false
ENVIRONMENT=production
WEBHOOK_URL=https://yourdomain.com
SENTRY_DSN=https://your-sentry-dsn
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞

- [ ] –°–æ–∑–¥–∞–Ω –±–æ—Ç –≤ @BotFather
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] –ó–∞–ø—É—â–µ–Ω–∞ PostgreSQL –ë–î
- [ ] –ó–∞–ø—É—â–µ–Ω Redis
- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- [ ] –ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∞–¥–º–∏–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –¥–æ–º–µ–Ω –¥–ª—è webhook (–ø—Ä–æ–¥–∞–∫—à–Ω)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### **–ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**

**–û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
python -m app.cli.database status

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –ë–î
python -m app.cli.database reset --force
```

**–ü—Ä–æ–±–ª–µ–º—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏:**
```bash
# –û—Ç–∫–∞—Ç–∏—Ç–µ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
python -m app.cli.database downgrade base
python -m app.cli.database upgrade
```

### **–õ–æ–≥–∏**
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ Docker
docker-compose logs -f bot

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
tail -f logs/app.log
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE)

## ü§ù –ö–æ–Ω—Ç—Ä–∏–±—å—é—Ü–∏—è

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch
3. –°–¥–µ–ª–∞–π—Ç–µ commit –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

---

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è ZOPH**# final-gram
